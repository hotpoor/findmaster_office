// Generated by CoffeeScript 1.12.7
(function() {
  var Hs, root;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.Hs || (root.Hs = {});

  Hs = root.Hs;

  $(function() {
    var get_chat;
    console.log("winni app user");
    get_chat = function(chat_id, comment_id, type) {
      if (comment_id == null) {
        comment_id = null;
      }
      if (comment_id === null) {
        $(".me_results").append("<div class=\"comments\" data-block=\"" + chat_id + "\">\n    <div class=\"comment_log\">Loading</div>\n</div>");
      }
      return $.ajax({
        url: "/api/page/comment/load",
        type: "GET",
        dataType: "json",
        data: {
          chat_id: chat_id,
          comment_id: comment_id
        },
        success: function(data) {
          var comment, comment_id_sequence, comment_json, e, i, ref;
          console.log(data);
          if (data.info === "error") {
            console.log(data.info);
            if (data.about === "no chat's comment") {
              console.log(data.about, "No more");
              return $(".comment_log").text("No More");
            }
          } else if (data.info = "ok") {
            ref = data.comments;
            for (i = ref.length - 1; i >= 0; i += -1) {
              comment = ref[i];
              comment_id_sequence = data.comment_id + "_" + comment[0];
              comment_json = null;
              try {
                comment_json = JSON.parse(comment[4]);
              } catch (error) {
                e = error;
                comment_json = null;
              }
              if (comment_json !== null) {
                $(".comments[data-block=" + chat_id + "]").append("<div class=\"comment\" data-id=\"" + comment_id_sequence + "\">\n    " + comment[4] + "\n</div>");
              }
            }
            if (data.last_comment_id === null) {
              $(".comment_log").remove();
              return $(".comments[data-block=" + chat_id + "]").append("<div class=\"comment_log\">No More</div>");
            } else {
              $(".comment_log").remove();
              return $(".comments[data-block=" + chat_id + "]").append("<div class=\"comment_load_more\" data-type=\"" + type + "\" data-last-comment-id=\"" + data.last_comment_id + "\">Click Load More</div>");
            }
          }
        },
        error: function(data) {
          return console.log(data);
        }
      });
    };
    $("body").on("click", ".comment_load_more", function(evt) {
      var chat_id, last_comment_id, load_type;
      load_type = $(this).attr("data-type");
      chat_id = $(this).parents(".comments").first().attr("data-block");
      last_comment_id = $(this).attr("data-last-comment-id");
      return get_chat(chat_id, last_comment_id, load_type);
    });
    $("body").on("click", ".get_orders", function(evt) {
      var chat_id;
      $(".me_results").empty();
      chat_id = $(this).attr("data-block");
      return get_chat(chat_id, null, "orders");
    });
    $("body").on("click", ".get_collections", function(evt) {
      var chat_id;
      $(".me_results").empty();
      chat_id = $(this).attr("data-block");
      return get_chat(chat_id, null, "collections");
    });
    return $("body").on("click", ".get_likes", function(evt) {
      var chat_id;
      $(".me_results").empty();
      chat_id = $(this).attr("data-block");
      return get_chat(chat_id, null, "likes");
    });
  });

}).call(this);
